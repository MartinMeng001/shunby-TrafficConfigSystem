# ConfigController API æ¥å£æ–‡æ¡£

## æ¦‚è¿°
ConfigController æä¾›äº¤é€šé…ç½®ç³»ç»Ÿçš„é…ç½®ç®¡ç†åŠŸèƒ½ï¼Œä¸¥æ ¼å®ç°ä»¥ä¸‹çº¦æŸï¼š
- **æ‰€æœ‰å‚æ•°åªèƒ½ä¿®æ”¹ï¼Œä¸èƒ½åˆ é™¤ï¼Œä¹Ÿä¸èƒ½å¢åŠ **
- **æ£€æµ‹ç‚¹å‚æ•°åªè¯»ï¼Œä¸å…è®¸å¢åŠ ï¼Œä¹Ÿä¸å…è®¸ä¿®æ”¹**

**Base URL**: `/api/config`

---

## ğŸ” æŸ¥è¯¢æ¥å£

### 1. è·å–å®Œæ•´é…ç½®

**æ¥å£**: `GET /full`

**æè¿°**: è·å–ç³»ç»Ÿå®Œæ•´é…ç½®ä¿¡æ¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "global": {
    "allRed": 120,
    "maxAllRed": 300,
    "platformUrl": "122.5.105.22:2020",
    "signalControllerList": [
      {"name": "ä¸Šè¡Œå…¥å£ä¿¡å·æœº", "id": "37"},
      {"name": "ä¿¡å·æœº2", "id": "38"}
    ]
  },
  "segments": {
    "size": 4,
    "segmentList": [
      {
        "segmentId": 1,
        "name": "è·¯æ®µ1",
        "length": 1000,
        "minRed": 5,
        "maxRed": 60,
        "minGreen": 5,
        "maxGreen": 15,
        "upsigid": "37",
        "downsigid": "38"
      }
    ]
  },
  "detectPoints": {
    "detectPointList": [
      {
        "index": 1,
        "details": "è·¯æ®µ1ä¸Šè¡Œæ£€æµ‹"
      }
    ]
  },
  "waitingAreas": {
    "waitingAreas": [
      {
        "index": 1,
        "upCapacity": 2,
        "downCapacity": 2
      }
    ]
  }
}
```

---

### 2. è·å–å…¨å±€é…ç½®

**æ¥å£**: `GET /global`

**æè¿°**: è·å–å…¨å±€é…ç½®å‚æ•°

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "allRed": 120,
  "maxAllRed": 300,
  "platformUrl": "122.5.105.22:2020",
  "signalControllerList": [
    {"name": "ä¸Šè¡Œå…¥å£ä¿¡å·æœº", "id": "37"},
    {"name": "ä¿¡å·æœº2", "id": "38"},
    {"name": "ä¿¡å·æœº3", "id": "41"},
    {"name": "ä¿¡å·æœº4", "id": "42"},
    {"name": "ä¸‹è¡Œå…¥å£ä¿¡å·æœº", "id": "43"}
  ]
}
```

---

### 3. è·å–æ‰€æœ‰è·¯æ®µé…ç½®

**æ¥å£**: `GET /segments`

**æè¿°**: è·å–æ‰€æœ‰è·¯æ®µé…ç½®åˆ—è¡¨

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
[
  {
    "segmentId": 1,
    "name": "è·¯æ®µ1",
    "length": 1000,
    "minRed": 5,
    "maxRed": 60,
    "minGreen": 5,
    "maxGreen": 15,
    "upsigid": "37",
    "downsigid": "38"
  },
  {
    "segmentId": 2,
    "name": "è·¯æ®µ2",
    "length": 1000,
    "minRed": 5,
    "maxRed": 60,
    "minGreen": 5,
    "maxGreen": 15,
    "upsigid": "38",
    "downsigid": "41"
  }
]
```

---

### 4. æ ¹æ®ä¿¡å·ç¯IDè·å–è·¯æ®µé…ç½®

**æ¥å£**: `GET /segments/{sigid}`

**æè¿°**: æ ¹æ®ä¿¡å·ç¯IDè·å–ç‰¹å®šè·¯æ®µé…ç½®

**è¯·æ±‚å‚æ•°**:
- `sigid` (Path): ä¿¡å·ç¯IDï¼Œä¾‹å¦‚ "37"

**å“åº”ç¤ºä¾‹**:
```json
{
  "segmentId": 1,
  "name": "è·¯æ®µ1",
  "length": 1000,
  "minRed": 5,
  "maxRed": 60,
  "minGreen": 5,
  "maxGreen": 15,
  "upsigid": "37",
  "downsigid": "38"
}
```

**é”™è¯¯å“åº”**:
```json
// 404 Not Found
{
  "timestamp": "2025-08-20T10:30:00Z",
  "status": 404,
  "error": "Not Found",
  "path": "/api/config/segments/99"
}
```

---

### 5. æ ¹æ®åç§°è·å–è·¯æ®µé…ç½®

**æ¥å£**: `GET /segments/byname/{name}`

**æè¿°**: æ ¹æ®è·¯æ®µåç§°è·å–é…ç½®

**è¯·æ±‚å‚æ•°**:
- `name` (Path): è·¯æ®µåç§°ï¼Œä¾‹å¦‚ "è·¯æ®µ1"

**å“åº”ç¤ºä¾‹**:
```json
{
  "segmentId": 1,
  "name": "è·¯æ®µ1",
  "length": 1000,
  "minRed": 5,
  "maxRed": 60,
  "minGreen": 5,
  "maxGreen": 15,
  "upsigid": "37",
  "downsigid": "38"
}
```

---

### 6. è·å–æ‰€æœ‰æ£€æµ‹ç‚¹é…ç½®ï¼ˆåªè¯»ï¼‰

**æ¥å£**: `GET /detectpoints`

**æè¿°**: è·å–æ‰€æœ‰æ£€æµ‹ç‚¹é…ç½®ï¼Œä»…æŸ¥è¯¢ç”¨é€”

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
[
  {
    "index": 1,
    "details": "è·¯æ®µ1ä¸Šè¡Œæ£€æµ‹"
  },
  {
    "index": 2,
    "details": "è·¯æ®µ1ä¸‹è¡Œæ£€æµ‹"
  },
  {
    "index": 3,
    "details": "è·¯æ®µ2ä¸Šè¡Œæ£€æµ‹"
  }
]
```

---

### 7. æ ¹æ®ç´¢å¼•è·å–æ£€æµ‹ç‚¹é…ç½®ï¼ˆåªè¯»ï¼‰

**æ¥å£**: `GET /detectpoints/{index}`

**æè¿°**: æ ¹æ®ç´¢å¼•è·å–ç‰¹å®šæ£€æµ‹ç‚¹é…ç½®

**è¯·æ±‚å‚æ•°**:
- `index` (Path): æ£€æµ‹ç‚¹ç´¢å¼•ï¼Œä¾‹å¦‚ 1

**å“åº”ç¤ºä¾‹**:
```json
{
  "index": 1,
  "details": "è·¯æ®µ1ä¸Šè¡Œæ£€æµ‹"
}
```

---

### 8. è·å–æ‰€æœ‰ç­‰å¾…åŒºé…ç½®

**æ¥å£**: `GET /waitingareas`

**æè¿°**: è·å–æ‰€æœ‰ç­‰å¾…åŒºé…ç½®åˆ—è¡¨

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
[
  {
    "index": 1,
    "upCapacity": 2,
    "downCapacity": 2
  },
  {
    "index": 2,
    "upCapacity": 2,
    "downCapacity": 2
  },
  {
    "index": 3,
    "upCapacity": 2,
    "downCapacity": 2
  }
]
```

---

### 9. æ ¹æ®ç´¢å¼•è·å–ç­‰å¾…åŒºé…ç½®

**æ¥å£**: `GET /waitingareas/{index}`

**æè¿°**: æ ¹æ®ç´¢å¼•è·å–ç‰¹å®šç­‰å¾…åŒºé…ç½®

**è¯·æ±‚å‚æ•°**:
- `index` (Path): ç­‰å¾…åŒºç´¢å¼•ï¼Œä¾‹å¦‚ 1

**å“åº”ç¤ºä¾‹**:
```json
{
  "index": 1,
  "upCapacity": 2,
  "downCapacity": 2
}
```

---

## âœï¸ ä¿®æ”¹æ¥å£

### 10. æ›´æ–°å…¨å±€é…ç½®

**æ¥å£**: `PUT /global`

**æè¿°**: æ›´æ–°å…¨å±€é…ç½®å‚æ•°ï¼ˆä»…å…è®¸ä¿®æ”¹AllRedå’ŒMaxAllRedï¼‰

**è¯·æ±‚å‚æ•°**:
```json
{
  "allRed": 150,
  "maxAllRed": 350
}
```

**å­—æ®µè¯´æ˜**:
- `allRed`: å…¨çº¢æ—¶é—´ï¼ˆç§’ï¼‰ï¼ŒèŒƒå›´ï¼š1-600
- `maxAllRed`: æœ€å¤§å…¨çº¢æ—¶é—´ï¼ˆç§’ï¼‰ï¼ŒèŒƒå›´ï¼š1-1200ï¼Œä¸”å¿…é¡» >= allRed

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "å…¨å±€é…ç½®æ›´æ–°æˆåŠŸ",
  "data": {
    "allRed": 150,
    "maxAllRed": 350
  },
  "timestamp": 1692537600000
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "message": "AllRedå‚æ•°å¿…é¡»å¤§äº0",
  "timestamp": 1692537600000,
  "status": 400
}
```

---

### 11. æ›´æ–°è·¯æ®µé…ç½®

**æ¥å£**: `PUT /segments/{sigid}`

**æè¿°**: æ›´æ–°ç‰¹å®šè·¯æ®µçš„é…ç½®å‚æ•°ï¼ˆä¸å…è®¸ä¿®æ”¹segmentIdå’Œupsigidï¼‰

**è¯·æ±‚å‚æ•°**:
- `sigid` (Path): ä¿¡å·ç¯ID

**è¯·æ±‚ä½“**:
```json
{
  "segmentId": 1,
  "name": "è·¯æ®µ1_ä¿®æ”¹",
  "length": 1200,
  "minRed": 6,
  "maxRed": 65,
  "minGreen": 6,
  "maxGreen": 18,
  "upsigid": "37",
  "downsigid": "38"
}
```

**å­—æ®µè¯´æ˜**:
- `name`: è·¯æ®µåç§°
- `length`: è·¯æ®µé•¿åº¦ï¼ˆç±³ï¼‰ï¼Œå¿…é¡» > 0
- `minRed`: æœ€å°çº¢ç¯æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¿…é¡» > 0
- `maxRed`: æœ€å¤§çº¢ç¯æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¿…é¡» >= minRed
- `minGreen`: æœ€å°ç»¿ç¯æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¿…é¡» > 0
- `maxGreen`: æœ€å¤§ç»¿ç¯æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå¿…é¡» >= minGreen

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "è·¯æ®µé…ç½®æ›´æ–°æˆåŠŸ",
  "data": {
    "segmentId": 1,
    "name": "è·¯æ®µ1_ä¿®æ”¹",
    "length": 1200,
    "minRed": 6,
    "maxRed": 65,
    "minGreen": 6,
    "maxGreen": 18,
    "upsigid": "37",
    "downsigid": "38"
  },
  "timestamp": 1692537600000
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "message": "ä¸å…è®¸ä¿®æ”¹è·¯æ®µID",
  "timestamp": 1692537600000,
  "status": 400
}
```

---

### 12. æ›´æ–°ç­‰å¾…åŒºé…ç½®

**æ¥å£**: `PUT /waitingareas/{index}`

**æè¿°**: æ›´æ–°ç­‰å¾…åŒºå®¹é‡é…ç½®ï¼ˆä¸å…è®¸ä¿®æ”¹indexï¼‰

**è¯·æ±‚å‚æ•°**:
- `index` (Path): ç­‰å¾…åŒºç´¢å¼•

**è¯·æ±‚ä½“**:
```json
{
  "index": 1,
  "upCapacity": 3,
  "downCapacity": 4
}
```

**å­—æ®µè¯´æ˜**:
- `upCapacity`: ä¸Šè¡Œå®¹é‡ï¼ŒèŒƒå›´ï¼š1-100
- `downCapacity`: ä¸‹è¡Œå®¹é‡ï¼ŒèŒƒå›´ï¼š1-100

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "message": "ç­‰å¾…åŒºé…ç½®æ›´æ–°æˆåŠŸ",
  "data": {
    "index": 1,
    "upCapacity": 3,
    "downCapacity": 4
  },
  "timestamp": 1692537600000
}
```

---

## âŒ ç¦æ­¢æ“ä½œæ¥å£

### 13. ç¦æ­¢æ·»åŠ è·¯æ®µé…ç½®

**æ¥å£**: `POST /segments`

**æè¿°**: æ­¤æ“ä½œè¢«ç¦æ­¢

**å“åº”**:
```json
{
  "success": false,
  "message": "ä¸å…è®¸æ·»åŠ æ–°çš„è·¯æ®µé…ç½®ï¼Œåªèƒ½ä¿®æ”¹ç°æœ‰è·¯æ®µå‚æ•°",
  "timestamp": 1692537600000,
  "status": 403
}
```

---

### 14. ç¦æ­¢åˆ é™¤è·¯æ®µé…ç½®

**æ¥å£**: `DELETE /segments/{sigid}`

**æè¿°**: æ­¤æ“ä½œè¢«ç¦æ­¢

**å“åº”**:
```json
{
  "success": false,
  "message": "ä¸å…è®¸åˆ é™¤è·¯æ®µé…ç½®ï¼Œåªèƒ½ä¿®æ”¹ç°æœ‰è·¯æ®µå‚æ•°",
  "timestamp": 1692537600000,
  "status": 403
}
```

---

### 15-19. ç¦æ­¢æ£€æµ‹ç‚¹ç›¸å…³æ“ä½œ

**æ¥å£**:
- `POST /detectpoints`
- `PUT /detectpoints/{index}`
- `DELETE /detectpoints/{index}`

**å“åº”**:
```json
{
  "success": false,
  "message": "æ£€æµ‹ç‚¹é…ç½®ä¸ºåªè¯»ï¼Œä¸å…è®¸ä¿®æ”¹/æ·»åŠ /åˆ é™¤",
  "timestamp": 1692537600000,
  "status": 403
}
```

---

### 20-21. ç¦æ­¢ç­‰å¾…åŒºå¢åˆ æ“ä½œ

**æ¥å£**:
- `POST /waitingareas`
- `DELETE /waitingareas/{index}`

**å“åº”**:
```json
{
  "success": false,
  "message": "ä¸å…è®¸æ·»åŠ /åˆ é™¤ç­‰å¾…åŒºé…ç½®ï¼Œåªèƒ½ä¿®æ”¹ç°æœ‰ç­‰å¾…åŒºå‚æ•°",
  "timestamp": 1692537600000,
  "status": 403
}
```

---

## ğŸ› ï¸ å·¥å…·æ¥å£

### 22. åˆ·æ–°é…ç½®ç¼“å­˜

**æ¥å£**: `POST /refresh`

**æè¿°**: å¼ºåˆ¶åˆ·æ–°é…ç½®ç¼“å­˜

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "é…ç½®ç¼“å­˜åˆ·æ–°æˆåŠŸ",
  "timestamp": 1692537600000
}
```

---

### 23. å¥åº·æ£€æŸ¥

**æ¥å£**: `GET /health`

**æè¿°**: æ£€æŸ¥é…ç½®æœåŠ¡å¥åº·çŠ¶æ€

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "é…ç½®æœåŠ¡æ­£å¸¸",
  "configExists": true,
  "timestamp": 1692537600000
}
```

---

### 24. è·å–é…ç½®çº¦æŸè¯´æ˜

**æ¥å£**: `GET /constraints`

**æè¿°**: è·å–ç³»ç»Ÿé…ç½®çº¦æŸè§„åˆ™å’Œå…è®¸çš„æ“ä½œ

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "rules": {
    "å…¨å±€é…ç½®": "åªå…è®¸ä¿®æ”¹AllRedå’ŒMaxAllRedå‚æ•°ï¼Œä¸å…è®¸æ·»åŠ æˆ–åˆ é™¤å‚æ•°",
    "è·¯æ®µé…ç½®": "åªå…è®¸ä¿®æ”¹ç°æœ‰è·¯æ®µçš„å‚æ•°ï¼Œä¸å…è®¸æ·»åŠ æˆ–åˆ é™¤è·¯æ®µ",
    "æ£€æµ‹ç‚¹é…ç½®": "å®Œå…¨åªè¯»ï¼Œä¸å…è®¸ä»»ä½•ä¿®æ”¹ã€æ·»åŠ æˆ–åˆ é™¤æ“ä½œ",
    "ä¿¡å·æ§åˆ¶å™¨åˆ—è¡¨": "åªè¯»ï¼Œä¸å…è®¸ä¿®æ”¹",
    "ç­‰å¾…åŒºé…ç½®": "åªå…è®¸ä¿®æ”¹ç°æœ‰ç­‰å¾…åŒºçš„å®¹é‡å‚æ•°ï¼Œä¸å…è®¸æ·»åŠ æˆ–åˆ é™¤ç­‰å¾…åŒº"
  },
  "allowedOperations": {
    "GET": ["/full", "/global", "/segments", "/segments/{sigid}", "/detectpoints", "/detectpoints/{index}", "/waitingareas", "/waitingareas/{index}"],
    "PUT": ["/global", "/segments/{sigid}", "/waitingareas/{index}"],
    "POST": ["/refresh"],
    "ç¦æ­¢æ“ä½œ": ["POST /segments", "DELETE /segments/{sigid}", "POST /detectpoints", "PUT /detectpoints/{index}", "DELETE /detectpoints/{index}", "POST /waitingareas", "DELETE /waitingareas/{index}"]
  },
  "version": "1.0",
  "lastUpdated": 1692537600000
}
```

---

### 25. è°ƒè¯•é…ç½®ä¿¡æ¯

**æ¥å£**: `GET /debug`

**æè¿°**: è·å–é…ç½®åŠ è½½çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "configLoaded": true,
  "segmentsCount": 4,
  "detectPointsCount": 8,
  "waitingAreasCount": 3,
  "globalConfigExists": true,
  "detectPointsReadonly": true,
  "constraints": {
    "allowModifyGlobal": true,
    "allowModifySegments": true,
    "allowModifyDetectPoints": false,
    "allowModifyWaitingAreas": true,
    "allowAddDelete": false
  }
}
```

---

## ğŸ“‹ é€šç”¨é”™è¯¯ç 

| HTTPçŠ¶æ€ç  | æè¿° | ç¤ºä¾‹åœºæ™¯ |
|-----------|------|----------|
| 200 | æˆåŠŸ | æ­£å¸¸è·å–/æ›´æ–°é…ç½® |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | å‚æ•°éªŒè¯å¤±è´¥ |
| 403 | æ“ä½œè¢«ç¦æ­¢ | å°è¯•æ‰§è¡Œä¸å…è®¸çš„æ“ä½œ |
| 404 | èµ„æºä¸å­˜åœ¨ | æŸ¥è¯¢ä¸å­˜åœ¨çš„é…ç½®é¡¹ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | é…ç½®æ–‡ä»¶è¯»å†™å¼‚å¸¸ |

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **åœ¨é›†æˆå‰å…ˆè°ƒç”¨** `/api/config/constraints` äº†è§£æ‰€æœ‰çº¦æŸè§„åˆ™
2. **æ ¹æ®å“åº”çš„** `success` å­—æ®µåˆ¤æ–­æ“ä½œç»“æœ
3. **å¯¹äºä¿®æ”¹æ“ä½œï¼Œå»ºè®®å…ˆæŸ¥è¯¢ç°æœ‰é…ç½®å†è¿›è¡Œæ›´æ–°**
4. **ä½¿ç”¨** `/api/config/debug` æ¥å£è¿›è¡Œé—®é¢˜æ’æŸ¥
5. **æ‰€æœ‰æ—¶é—´å‚æ•°å•ä½ä¸ºç§’ï¼Œå®¹é‡å‚æ•°ä¸ºæ­£æ•´æ•°**